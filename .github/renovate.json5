// renovate.json5
{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended"
  ],

  // --- Global Configuration ---
  "pinDigests": false, // Explicitly confirms digest pinning is disabled
  "timezone": "America/Los_Angeles", // Pacific Northwest Time Zone (PST/PDT)
  "schedule": ["before 3am"],
  
  // These settings ensure patch updates are separated from minor updates and not discarded.
  "separateMajorMinor": true,
  "separateMinorPatch": true,

  // --- Security Alerts ---
  // Enables PRs for critical vulnerabilities detected via GitHub/OSV.dev
  "vulnerabilityAlerts": {
    "enabled": true
  },
  "osvVulnerabilityAlerts": true, 

  // --- Custom Manager Setup (.versions files) ---
  "enabledManagers": ["custom.regex"],
  "customManagers": [
    {
      "customType": "regex",
      "managerFilePatterns": ["public-images/**/*.versions"], // Explicitly finds custom files
      "matchStrings": [
        // Simple regex: dependency name followed by its value (currentValue is greedy)
        "(?<depName>.*?):(?<currentValue>.*)" 
      ],
      "datasourceTemplate": "docker"
    }
  ],

  // --- Rule Sets: Patch-Only Policy via Exclusion ---
  "packageRules": [
    // RULE 1: Apply Stability Filter (Must be a separate rule to avoid schema error)
    {
      "description": "Rule 1: Always Ignore Unstable Releases",
      "matchManagers": ["custom.regex", "dockerfile"], 
      "ignoreUnstable": true 
    },
    
    // RULE 2: Policy for Custom (.versions) Files 
    {
      "description": "Custom Files: Patch Only Policy",
      "matchManagers": ["custom.regex"], 
      "matchUpdateTypes": [
        "major",
        "minor"
      ],
      "enabled": false, // Disables these high-risk updates (rejects Python 3.14.x)
      "groupName": "Base Image Version Updates (.versions)",
      "groupSlug": "base-images-versions"
    },
    
    // RULE 3: Policy for Dockerfiles (base-images/**/Dockerfiles)
    {
      "description": "Dockerfile: Patch Only Policy",
      "matchManagers": ["dockerfile"], 
      "matchUpdateTypes": [
        "major",
        "minor"
      ],
      "enabled": false, // Disables these high-risk updates (rejects Ubuntu 24.04 LTS)
      "matchFileNames": ["base-images/**"], 
      "matchDatasources": ["docker"],       
      "groupName": "Dockerfile Dependency Updates",
      "groupSlug": "dockerfile-updates"
    }
  ]
}