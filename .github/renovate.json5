// renovate.json5
{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended"
  ],

  // --- Global Settings ---
  "pinDigests": false, 
  "timezone": "America/Los_Angeles", // Pacific Northwest Time Zone
  "schedule": ["before 3am"],
  
  // These settings ensure that minor (3.9 -> 3.14) and patch (3.9.23 -> 3.9.25) 
  // updates are treated as separate candidates so the patch isn't discarded.
  "separateMajorMinor": true,
  "separateMinorPatch": true,

  // --- Security Alerts ---
  // Enables PRs for critical vulnerabilities, which bypasses the packageRules filter.
  "vulnerabilityAlerts": {
    "enabled": true
  },
  "osvVulnerabilityAlerts": true, 

  // --- Custom Manager Setup (for .versions files) ---
  "enabledManagers": ["custom.regex"],
  "customManagers": [
    {
      "customType": "regex",
      "managerFilePatterns": ["public-images/**/*.versions"],
      "matchStrings": [
        // Simple regex matching 'depName:currentValue'
        "(?<depName>.*?):(?<currentValue>.*)" 
      ],
      "datasourceTemplate": "docker"
    }
  ],

  // --- Rule Sets: Blocking Major/Minor Updates for Both File Types ---
  "packageRules": [
    {
      "description": "Rule 1: Custom .versions Files (Block Minor/Major)",
      "matchManagers": ["custom.regex"], 
      "matchUpdateTypes": [
        "major",
        "minor" // Blocks application version bumps (e.g., Python 3.9 -> 3.14)
      ],
      "enabled": false, // Disables these high-risk updates
      "ignoreUnstable": true, // Skips -beta, -rc, etc., for extra stability
      "groupName": "Base Image Version Updates (.versions)",
      "groupSlug": "base-images-versions"
    },
    {
      "description": "Rule 2: Standard Dockerfile Updates (Block Minor/Major)",
      "matchManagers": ["dockerfile"], 
      "matchUpdateTypes": [
        "major",
        "minor"
      ],
      "enabled": false,
      "ignoreUnstable": true,
      "groupName": "Dockerfile Dependency Updates",
      "groupSlug": "dockerfile-updates"
    }
  ]
}